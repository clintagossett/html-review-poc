# Subtask 02: Video Assembly Implementation

**Parent Task:** 00013-update-validation-video-methodology
**Status:** OPEN
**Created:** 2025-12-26

---

## Objective

Create tooling to automatically assemble E2E test recordings into a final validation video with title slides between sections.

---

## Requirements

### Functional Requirements
1. **Concatenate clips** - Combine multiple .webm files from a single test journey
2. **Create title slides** - Generate title cards using ffmpeg or images
3. **Normalize videos** - Ensure consistent resolution, fps, codec across all clips
4. **Master assembly** - Combine all journeys with titles into final MP4

### Video Specifications
- **Resolution:** 1280x720 (letterbox if needed)
- **FPS:** 30
- **Codec:** H.264 (libx264)
- **Format:** MP4 (yuv420p for compatibility)
- **Audio:** Remove (silent demos)
- **Title duration:** 3 seconds per slide

---

## Files

| File | Description |
|------|-------------|
| `README.md` | This file |
| `assemble-validation-video.sh` | Main assembly script (to be created) |
| `video_assembler.py` | Python implementation (optional, to be created) |
| `example-assembly.md` | Usage examples (to be created) |

---

## Implementation Plan

### Phase 1: Basic Scripts (Bash)

1. **concat_journey.sh** - Combine clips within a single journey folder
   - Input: Directory containing .webm files
   - Output: `flow.webm` in same directory
   - Use ffmpeg concat demuxer

2. **create_title.sh** - Generate title slide video
   - Input: Title text
   - Output: MP4 title slide (3 seconds)
   - Use ffmpeg drawtext filter

3. **normalize_video.sh** - Convert webm to normalized MP4
   - Input: .webm file
   - Output: Normalized MP4 (1280x720, 30fps, H.264)
   - Force aspect ratio with letterboxing

4. **assemble_master.sh** - Orchestrate full assembly
   - Input: Configuration (journey titles + directories)
   - Output: master-validation.mp4
   - Calls above scripts in sequence

### Phase 2: Python Script (Optional Enhancement)

Create `video_assembler.py` for more flexibility:
- Better error handling
- Progress reporting
- Parallel processing
- Configurable via JSON/YAML

---

## Reference Implementation

Source: `/Users/clintgossett/Documents/Applied Frameworks/af projects/engage all/engage/docs/tasks/00077-claude-ui-exploration/runner/video_assembly.md`

Key workflows to implement:
1. Collect clips per journey
2. Concatenate within journey
3. Generate title slides
4. Normalize all videos
5. Create master concat list
6. Final assembly

---

## How This Will Be Used

### Directory Structure
```
tasks/00006-magic-link-auth/
└── tests/
    ├── e2e/
    │   ├── login-flow.spec.ts
    │   ├── signup-flow.spec.ts
    │   └── password-reset.spec.ts
    ├── test-results/
    │   ├── login-flow/video.webm
    │   ├── signup-flow/video.webm
    │   └── password-reset/video.webm
    └── validation-videos/
        └── master-validation.mp4  # Generated by assembly script
```

### Usage Example
```bash
# From task tests directory
cd tasks/00006-magic-link-auth/tests

# Run assembly script
../../../scripts/assemble-validation-video.sh \
  --title "Login Flow" test-results/login-flow \
  --title "Signup Flow" test-results/signup-flow \
  --title "Password Reset" test-results/password-reset \
  --output validation-videos/master-validation.mp4
```

### Alternative: Python Script
```bash
python ../../../scripts/video_assembler.py \
  --output validation-videos/master-validation.mp4 \
  --journey "Login Flow" test-results/login-flow \
  --journey "Signup Flow" test-results/signup-flow \
  --journey "Password Reset" test-results/password-reset
```

---

## Integration with Workflow

### Updated Test Workflow
1. **Write E2E tests** - Create test scenarios
2. **Run tests** - Playwright generates videos with click indicators
3. **Assemble validation** - Run assembly script to create master video
4. **Review** - Watch master video to verify feature
5. **Commit** - Include master validation video in task

### Documentation Updates
- Add "Automated Validation Videos" section to testing guide
- Replace manual video recording instructions
- Document assembly script usage
- Provide troubleshooting guide

---

## Success Criteria

- [ ] Bash scripts created and functional
- [ ] Python script created (optional)
- [ ] Can combine multiple test videos with title slides
- [ ] Output is consistent 1280x720 MP4
- [ ] Documentation shows clear assembly workflow
- [ ] Example validation video demonstrates full process
- [ ] Testing guide updated with automated approach
